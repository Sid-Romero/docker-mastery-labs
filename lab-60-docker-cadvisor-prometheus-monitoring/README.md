# Lab 60: Dockerized Monitoring with cAdvisor and Prometheus

![Difficulty: Medium](https://img.shields.io/badge/Difficulty-Medium-yellow) ![Docker](https://img.shields.io/badge/Docker-2496ED?logo=docker&logoColor=white)

> **Auto-generated lab** - Created on 2026-01-14

## Description

This lab demonstrates how to containerize cAdvisor and Prometheus to monitor Docker containers. It provides a hands-on experience in setting up a basic monitoring stack using Docker Compose.

## Learning Objectives

- Understand how to containerize cAdvisor and Prometheus.
- Learn how to configure Prometheus to scrape metrics from cAdvisor.
- Set up a basic monitoring stack using Docker Compose.
- Visualize container metrics using Prometheus's built-in UI.

## Prerequisites

- Docker installed and running
- Docker Compose installed

## Lab Steps

### Step 1: Create Project Directory

Create a new directory for your project:

```bash
mkdir docker-monitoring
cd docker-monitoring
```

### Step 2: Create Docker Compose File

Create a `docker-compose.yml` file with the following content. This file defines the services for cAdvisor and Prometheus.

```yaml
version: '3.8'

services:
  cadvisor:
    image: gcr.io/cadvisor/cadvisor:v0.47.0
    container_name: cadvisor
    ports:
      - "8080:8080"
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
    restart: unless-stopped

  prometheus:
    image: prom/prometheus:v2.46.0
    container_name: prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    depends_on:
      - cadvisor
    restart: unless-stopped
```

This Compose file defines two services: `cadvisor` and `prometheus`.  `cadvisor` collects container metrics, and `prometheus` scrapes and stores these metrics. The volumes in `cadvisor` give it access to the host's file system to gather container statistics.

### Step 3: Create Prometheus Configuration File

Create a `prometheus.yml` file with the following content.  This configuration tells Prometheus where to find cAdvisor.

```yaml
global:
  scrape_interval:     15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
```

This configuration defines a `scrape_config` for `cadvisor`.  It specifies that Prometheus should scrape metrics from `cadvisor` every 15 seconds.  The `targets` field specifies the hostname and port where `cadvisor` is running.  Since they are running in the same Docker network, we can use the service name `cadvisor` as the hostname.

### Step 4: Start the Services

Start the services using Docker Compose:

```bash
docker-compose up -d
```

This command will download the necessary images and start the containers in detached mode.

### Step 5: Access Prometheus UI

Open your web browser and navigate to `http://localhost:9090`. This will open the Prometheus UI.

In the Prometheus UI, you can query metrics collected from cAdvisor. For example, try querying `container_cpu_usage_seconds_total` to see CPU usage metrics for your containers.  You can also graph these metrics to visualize container performance.

### Step 6: Explore cAdvisor UI

Open your web browser and navigate to `http://localhost:8080`. This will open the cAdvisor UI.  You can browse through the containers and view their resource usage metrics directly in cAdvisor. This can be helpful for verifying that cAdvisor is working correctly before relying solely on Prometheus.

### Step 7: Stop the Services

Stop the services when you are finished:

```bash
docker-compose down
```

This command will stop and remove the containers.


<details>
<summary> Hints (click to expand)</summary>

1. Make sure Docker is running before starting the services.
2. Check the Docker Compose logs if the services fail to start.
3. Verify that the Prometheus configuration file is correctly formatted.
4. Ensure that the cAdvisor and Prometheus containers can communicate with each other.
5. If you are having trouble accessing the UIs, check your firewall settings.

</details>


<details>
<summary>âœ… Solution Notes (spoiler)</summary>

This lab sets up a basic monitoring stack using cAdvisor and Prometheus. cAdvisor collects container metrics, and Prometheus scrapes and stores these metrics. The Prometheus UI can then be used to query and visualize these metrics.

</details>


---

## Notes

- **Difficulty:** Medium
- **Estimated time:** 45-75 minutes
- **Technology:** Docker

##  Cleanup

Don't forget to clean up resources after completing the lab:

```bash
# Example cleanup commands (adjust based on lab content)
docker system prune -f
# or
kubectl delete -f .
# or
helm uninstall <release-name>
```

---

*This lab was auto-generated by the [Lab Generator Bot](../.github/workflows/generate-lab.yml)*
