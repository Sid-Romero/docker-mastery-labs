# Lab 47: Terraform: Provisioning a Docker Container

![Difficulty: Easy](https://img.shields.io/badge/Difficulty-Easy-brightgreen) 

> **Auto-generated lab** - Created on 2026-01-03

## Description

This lab demonstrates how to use Terraform to provision a Docker container on your local machine. It covers basic Terraform concepts like providers, resources, and variables.

## Learning Objectives

- Understand the basic Terraform workflow.
- Learn how to define and manage Docker resources with Terraform.
- Provision and destroy a Docker container using Terraform.

## Prerequisites

- Docker Desktop installed and running.
- Terraform installed (version >= 1.0).
- Basic understanding of Docker concepts.

## Lab Steps

### Step 1: Step 1: Create a Terraform Configuration File

Create a new directory for your Terraform project, and within that directory, create a file named `main.tf`. This file will contain your Terraform configuration.

```bash
mkdir terraform-docker
cd terraform-docker
touch main.tf
```

### Step 2: Step 2: Define the Docker Provider

Open `main.tf` in a text editor and add the following configuration to define the Docker provider. This tells Terraform how to interact with your local Docker daemon.

```terraform
terraform {
  required_providers {
    docker = {
      source  = "kreuzwerker/docker"
      version = "~> 3.0"
    }
  }
}

provider "docker" {}
```

### Step 3: Step 3: Define a Docker Image Resource

Now, define a Docker image resource. This will instruct Terraform to pull the specified image from Docker Hub if it doesn't already exist locally.

```terraform
resource "docker_image" "nginx_image" {
  name = "nginx:latest"
  keep_locally = false
}
```

This configuration pulls the latest `nginx` image. `keep_locally = false` ensures that the image is not kept locally after the container is destroyed.

### Step 4: Step 4: Define a Docker Container Resource

Next, define a Docker container resource. This will create and start a container based on the image we defined in the previous step.

```terraform
resource "docker_container" "nginx_container" {
  name  = "nginx-container"
  image = docker_image.nginx_image.latest
  ports {
    internal = 80
    external = 8000
  }
}
```

This configuration creates a container named `nginx-container` using the `nginx` image. It also maps port 80 inside the container to port 8000 on your host machine.

### Step 5: Step 5: Initialize Terraform

Before you can apply the configuration, you need to initialize Terraform. This downloads the necessary provider plugins.

```bash
terraform init
```

### Step 6: Step 6: Apply the Terraform Configuration

Now, apply the configuration to create the Docker container.

```bash
terraform apply
```

Terraform will show you a plan of the changes it will make. Type `yes` to confirm and proceed.

### Step 7: Step 7: Verify the Container is Running

Check if the container is running using Docker CLI.

```bash
docker ps
```

You should see the `nginx-container` running.  You can also access the Nginx default page by opening `http://localhost:8000` in your web browser.

### Step 8: Step 8: Destroy the Infrastructure

To destroy the container and remove the image (if `keep_locally = false`), use the following command:

```bash
terraform destroy
```

Again, Terraform will show you a plan of the changes it will make. Type `yes` to confirm and proceed.


<details>
<summary> Hints (click to expand)</summary>

1. If `terraform init` fails, check your Terraform version and ensure that the Docker provider is available.
2. If `terraform apply` fails, check your Docker daemon is running correctly and that there are no port conflicts.

</details>


<details>
<summary>âœ… Solution Notes (spoiler)</summary>

The solution involves defining a Terraform configuration file (`main.tf`) that specifies the Docker provider, a Docker image resource (nginx:latest), and a Docker container resource. The `terraform init` command initializes the Terraform project, downloading the necessary provider plugins. The `terraform apply` command then provisions the Docker container based on the configuration. Finally, `terraform destroy` removes the provisioned resources.

</details>


---

## Notes

- **Difficulty:** Easy
- **Estimated time:** 30-45 minutes
- **Technology:** Terraform

##  Cleanup

Don't forget to clean up resources after completing the lab:

```bash
# Example cleanup commands (adjust based on lab content)
docker system prune -f
# or
kubectl delete -f .
# or
helm uninstall <release-name>
```

---

*This lab was auto-generated by the [Lab Generator Bot](../.github/workflows/generate-lab.yml)*
